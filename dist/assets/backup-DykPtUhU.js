import{t as g}from"./index-DEkH4kEK.js";import{_ as ae,u as oe,a as le,g as ne,c as N,o as se,r as h,A as i,d as ce,e as ie,f as t,w as a,p as q,j as l,i as r,m as p,t as s,V as re,z as E,x as y,v as S,y as L}from"./index-CS37_vV1.js";import{f as ue,s as de}from"./tools-Dm5phYt7.js";const me={class:"page-div"},pe={class:"card-header"},fe={style:{"margin-top":"20px"}},he={style:{"line-height":"50px"}},_e={style:{"line-height":"50px"}},ge={style:{"line-height":"50px"}},be={style:{"line-height":"50px"}},ve={class:"card-header"},ke=re({name:"toolsBackup"}),we=Object.assign(ke,{setup(ye){const{t:o}=oe(),{isMobile:x}=le(),V=ne(),P=N(()=>V.isDark),u=N(()=>V.language);se(()=>{v()});const B=h(!1),T=h(!1),F=h([]),_=h({enable:!1,time:"00:00:00"}),M=h(0),v=()=>{g.backup.get().then(e=>{F.value=e.data.backupFiles,_.value=e.data.backupSetting,M.value=e.data.diskUsage})},$=()=>{if(!_.value.time){E(o("tools.backup.timeChangeTip"));return}B.value=!0,T.value=!0;const e={time:_.value.time,enable:_.value.enable};g.backup.put(e).then(n=>{y(n.message)}).finally(()=>{B.value=!1,T.value=!1})},j=e=>{S.confirm(u.value==="zh"?"将执行删除操作，是否继续？":"The DELETE operation will be performed. Do you want to continue?",u.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:u.value==="zh"?"确定":"confirm",cancelButtonText:u.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(n,c,m)=>{if(n==="confirm"){c.confirmButtonLoading=!0;const f={name:e.name};g.backup.delete(f).then(k=>{y(k.message),m()}).catch(()=>{}).finally(()=>{c.confirmButtonLoading=!1,v()})}else m()}}).then(()=>{}).catch(()=>{L(o("home.canceled"))}).finally(()=>{b.value=!1})},A=e=>{S.confirm(u.value==="zh"?"将执行恢复操作，是否继续？":"The RESTORE operation will be performed. Do you want to continue?",u.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:u.value==="zh"?"确定":"confirm",cancelButtonText:u.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(n,c,m)=>{if(n==="confirm"){c.confirmButtonLoading=!0;const f={name:e.name};g.backupRestore.post(f).then(k=>{y(k.message),m()}).catch(()=>{}).finally(()=>{c.confirmButtonLoading=!1,v()})}else m()}}).then(()=>{}).catch(()=>{L(o("home.canceled"))}).finally(()=>{b.value=!1})},H=()=>{if(z.value.length===0){E(o("tools.backup.deleteTip"));return}S.confirm(u.value==="zh"?"将执行删除操作，是否继续？":"The DELETE operation will be performed. Do you want to continue?",u.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:u.value==="zh"?"确定":"confirm",cancelButtonText:u.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(e,n,c)=>{if(e==="confirm"){n.confirmButtonLoading=!0;const m={names:[]};for(let f of z.value)m.names.push(f.name);g.multiDelete.delete(m).then(f=>{y(f.message),c()}).catch(()=>{}).finally(()=>{n.confirmButtonLoading=!1,v()})}else c()}}).then(()=>{}).catch(()=>{L(o("home.canceled"))})},O=h(),z=h([]),G=e=>{z.value=e},J=e=>{g.backupDownload.post({filename:e.name}).then(async n=>{await de(n.data,e.name)}).finally(()=>{b.value=!1})},b=h(!1),K=e=>{let n=e.cmd,c=e.row;switch(b.value=!0,n){case"download":J(c);break;case"restore":A(c);break;case"delete":j(c);break;default:b.value=!1,E("error")}},C=h(!1),Q=()=>{C.value=!0,g.backup.post().then(e=>{y(e.message)}).finally(()=>{C.value=!1,v()})};return(e,n)=>{const c=i("el-button"),m=i("el-progress"),f=i("el-time-picker"),k=i("el-switch"),W=i("el-alert"),R=i("el-card"),I=i("el-col"),w=i("el-table-column"),X=i("arrow-down"),Y=i("el-icon"),D=i("el-dropdown-item"),Z=i("el-dropdown-menu"),ee=i("el-dropdown"),te=i("el-table"),U=i("el-row");return ce(),ie("div",me,[t(U,{gutter:10},{default:a(()=>[t(I,{lg:12,md:12,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:a(()=>[t(R,{style:q(l(x)?"min-height: 500px":"min-height: 700px"),shadow:"never"},{header:a(()=>[r("div",pe,[p(s(l(o)("tools.backup.title1"))+" ",1),t(c,{type:"primary",onClick:Q,loading:C.value},{default:a(()=>[p(s(l(o)("tools.backup.BackupImmediately")),1)]),_:1},8,["loading"])])]),default:a(()=>[r("div",null,[t(m,{percentage:parseFloat(M.value.toFixed(1))},{default:a(({percentage:d})=>[r("span",null,s(l(o)("tools.backup.processBar"))+s(d)+"%",1)]),_:1},8,["percentage"])]),r("div",fe,[r("div",he,[r("span",null,s(l(o)("tools.backup.text1")),1),t(f,{modelValue:_.value.time,"onUpdate:modelValue":n[0]||(n[0]=d=>_.value.time=d),loading:B.value,style:{width:"120px",margin:"0 8px"},clearable:!1,editable:!1,"value-format":"HH:mm:ss",onChange:$},null,8,["modelValue","loading"]),r("span",null,s(l(o)("tools.backup.text2")),1)]),r("div",_e,[r("span",null,s(l(o)("tools.backup.text3")),1),t(k,{modelValue:_.value.enable,"onUpdate:modelValue":n[1]||(n[1]=d=>_.value.enable=d),loading:T.value,"active-text":e.$t("tools.backup.switchEnable"),"inactive-text":e.$t("tools.backup.switchDisable"),"inline-prompt":"",onChange:$,style:{margin:"0 8px","--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","loading","active-text","inactive-text"])]),r("div",ge,[r("span",null,s(l(o)("tools.backup.text4")),1)]),r("div",be,[r("span",null,s(l(o)("tools.backup.text5")),1)])]),t(W,{effect:P.value?"light":"dark",type:"warning",closable:!1,style:{"margin-top":"20px"}},{default:a(()=>[p(s(l(o)("tools.backup.alert")),1)]),_:1},8,["effect"])]),_:1},8,["style"])]),_:1}),t(I,{lg:12,md:12,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:a(()=>[t(R,{style:q(l(x)?"min-height: 500px":"min-height: 700px"),shadow:"never"},{header:a(()=>[r("div",ve,[p(s(l(o)("tools.backup.title2"))+" ",1),t(c,{type:"danger",onClick:H},{default:a(()=>[p(s(l(o)("tools.backup.multiDelete")),1)]),_:1})])]),default:a(()=>[r("div",null,[t(U,null,{default:a(()=>[t(te,{ref_key:"tableRef",ref:O,data:F.value,border:"",onSelectionChange:G,"max-height":l(x)?450:550},{default:a(()=>[t(w,{type:"selection",width:"55",fixed:"left"}),t(w,{label:e.$t("tools.backup.tableName"),prop:"name"},null,8,["label"]),t(w,{label:e.$t("tools.backup.size"),prop:"size"},{default:a(d=>[p(s(l(ue)(d.row.size)),1)]),_:1},8,["label"]),t(w,{label:e.$t("tools.backup.tableCreateTime"),prop:"createTime"},null,8,["label"]),t(w,{prop:"actions",label:e.$t("setting.button.actions"),width:"120px"},{default:a(d=>[t(ee,{onCommand:K,trigger:"click"},{dropdown:a(()=>[t(Z,null,{default:a(()=>[t(D,{command:{cmd:"download",row:d.row}},{default:a(()=>[p(s(l(o)("tools.backup.download")),1)]),_:2},1032,["command"]),t(D,{command:{cmd:"restore",row:d.row}},{default:a(()=>[p(s(l(o)("tools.backup.restore")),1)]),_:2},1032,["command"]),t(D,{command:{cmd:"delete",row:d.row}},{default:a(()=>[p(s(l(o)("tools.backup.delete")),1)]),_:2},1032,["command"])]),_:2},1024)]),default:a(()=>[t(c,{type:"primary",link:"",loading:b.value},{default:a(()=>[p(s(l(o)("setting.button.actions")),1),t(Y,{class:"el-icon--right"},{default:a(()=>[t(X)]),_:1})]),_:1},8,["loading"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data","max-height"])]),_:1})])]),_:1},8,["style"])]),_:1})]),_:1})])}}}),ze=ae(we,[["__scopeId","data-v-5fb2b66e"]]);export{ze as default};
