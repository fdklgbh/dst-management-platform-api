import{o as ne,g as re,c as ue,a5 as ie,u as de,r as k,R as D,K as r,e as c,f as I,j as e,k as l,l as _,t as i,i as o,p,m as v,q as b,F as me,x as ce,a1 as pe,ai as R,X as N,B as E,E as _e,C as ve}from"./index-7NUCbB-L.js";import{S as fe}from"./index-B340vLo3.js";const be={class:"page-div"},ge={class:"card-header"},he={class:"tip"},we={style:{"margin-top":"5px"}},ye={style:{"margin-top":"5px"}},Ve={class:"tip"},ke={class:"el-form-item-msg"},xe={style:{display:"flex","justify-content":"flex-end","padding-top":"10px"}},Ce=pe({name:"Users"}),ze=Object.assign(Ce,{setup(Pe){ne(()=>{C()});const q=re(),d=ue(()=>q.language),j=ie(),{t:s}=de(),z=j.userInfo,L=k([]),C=()=>{D.userList.get().then(u=>{L.value=u.data})},O=u=>{if(u.type==="update"){G(R(u.data));return}u.type==="delete"&&K(R(u.data))},g=k(),a=k({username:"",nickname:"",password:"",disabled:!1,role:"Non-admin",clusterPermission:null,clusterCreationProhibited:!1}),Y={username:[{required:!0,message:s("users.formValidateMsg.username")}],nickname:[{required:!0,message:s("users.formValidateMsg.nickname")}],password:[{required:!0,message:s("users.formValidateMsg.password")}],disabled:[{required:!0,message:s("users.formValidateMsg.disabled")}]},w=k(!1),y=k(!1),V=k(!1),A=()=>{g.value&&g.value.clearValidate(),V.value=!0,w.value=!0},$=()=>{g.value.validate(u=>{if(u){y.value=!0;const n={username:a.value.username,nickname:a.value.nickname,password:N(a.value.password),disabled:a.value.disabled,role:a.value.role,clusterPermission:a.value.clusterPermission,clusterCreationProhibited:a.value.clusterCreationProhibited};D.user.post(n).then(m=>{w.value=!1,E(m.message),C()}).finally(()=>{y.value=!1})}})},G=u=>{a.value=u,V.value=!1,w.value=!0},H=()=>{g.value.validate(u=>{if(u){y.value=!0;const n={username:a.value.username,nickname:a.value.nickname,password:N("nicai"),disabled:a.value.disabled,role:a.value.role,clusterPermission:a.value.clusterPermission,clusterCreationProhibited:a.value.clusterCreationProhibited};D.user.put(n).then(m=>{w.value=!1,g.value&&g.value.resetFields(),E(m.message),C()}).finally(()=>{y.value=!1})}})},K=u=>{_e.confirm(d.value==="zh"?"将执行 删除 操作，是否继续？":"The DELETE operation will be performed. Do you want to continue?",d.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:d.value==="zh"?"确定":"confirm",cancelButtonText:d.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(n,m,P)=>{if(n==="confirm"){m.confirmButtonLoading=!0;const F={username:u.username,nickname:u.nickname,password:N("nicai"),disabled:u.disabled};D.user.delete(F).then(f=>{E(f.message),C(),P()}).finally(()=>{m.confirmButtonLoading=!1})}else P()}}).then(()=>{}).catch(()=>{ve(s("home.canceled"))})},X=()=>{a.value={username:"",nickname:"",password:"",disabled:!1,role:"Non-admin",clusterPermission:null,clusterCreationProhibited:!1}};return(u,n)=>{const m=r("el-button"),P=r("el-collapse-item"),F=r("el-collapse"),f=r("el-table-column"),x=r("el-tag"),J=r("arrow-down"),Q=r("el-icon"),M=r("el-dropdown-item"),W=r("el-dropdown-menu"),Z=r("el-dropdown"),ee=r("el-table"),le=r("el-card"),U=r("el-col"),T=r("el-row"),S=r("el-input"),h=r("el-form-item"),ae=r("el-option"),te=r("el-select"),B=r("el-switch"),se=r("el-form"),oe=r("el-dialog");return c(),I("div",be,[e(T,{gutter:10},{default:l(()=>[e(U,{lg:24,md:24,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:l(()=>[e(le,{shadow:"never",style:{"min-height":"70vh"}},{header:l(()=>[_("div",ge,[_("span",null,i(o(s)("users.accountTitle")),1),e(m,{disabled:o(z).role!=="admin",type:"success",onClick:A},{default:l(()=>[p(i(o(s)("users.actions.create")),1)]),_:1},8,["disabled"])])]),default:l(()=>[e(F,null,{default:l(()=>[e(P,{title:"Tips"},{default:l(()=>[_("div",he,[_("div",null,i(o(s)("users.tip_1")),1),_("div",we,i(o(s)("users.tip_2")),1),_("div",ye,i(o(s)("users.tip_3")),1)]),_("div",Ve,[_("div",null,i(o(s)("users.tip_4")),1)])]),_:1})]),_:1}),e(ee,{data:L.value,border:"",style:{"margin-top":"10px"}},{default:l(()=>[e(f,{label:o(s)("users.username"),prop:"username"},null,8,["label"]),e(f,{label:o(s)("users.nickname"),prop:"nickname"},null,8,["label"]),e(f,{label:o(s)("users.role"),prop:"role"},{default:l(t=>[e(x,{type:t.row.role==="admin"?"primary":"info"},{default:l(()=>[p(i(t.row.role),1)]),_:2},1032,["type"])]),_:1},8,["label"]),e(f,{label:o(s)("users.disabled")},{default:l(t=>[t.row.disabled?b("",!0):(c(),v(x,{key:0,type:"success"},{default:l(()=>[p(i(d.value==="zh"?"启用":"Enabled"),1)]),_:1})),t.row.disabled?(c(),v(x,{key:1,type:"danger"},{default:l(()=>[p(i(d.value==="zh"?"禁用":"Disabled"),1)]),_:1})):b("",!0)]),_:1},8,["label"]),e(f,{label:o(s)("users.clusterCreationProhibited")},{default:l(t=>[t.row.clusterCreationProhibited?b("",!0):(c(),v(x,{key:0,type:"success"},{default:l(()=>[p(i(d.value==="zh"?"可创建":"Y"),1)]),_:1})),t.row.clusterCreationProhibited?(c(),v(x,{key:1,type:"danger"},{default:l(()=>[p(i(d.value==="zh"?"不可创建":"N"),1)]),_:1})):b("",!0)]),_:1},8,["label"]),e(f,{label:o(s)("setting.button.actions"),prop:"actions"},{default:l(t=>[e(Z,{disabled:o(z).role!=="admin",trigger:"hover",onCommand:O},{dropdown:l(()=>[e(W,null,{default:l(()=>[e(M,{command:{type:"update",data:t.row}},{default:l(()=>[p(i(o(s)("users.actions.update")),1)]),_:2},1032,["command"]),e(M,{command:{type:"delete",data:t.row},disabled:t.row.role==="admin"},{default:l(()=>[p(i(o(s)("users.actions.delete")),1)]),_:2},1032,["command","disabled"])]),_:2},1024)]),default:l(()=>[e(m,{disabled:o(z).role!=="admin",link:"",type:"primary"},{default:l(()=>[p(i(o(s)("setting.button.actions"))+" ",1),e(Q,{class:"el-icon--right"},{default:l(()=>[e(J)]),_:1})]),_:1},8,["disabled"])]),_:2},1032,["disabled"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})]),_:1})]),_:1}),e(oe,{modelValue:w.value,"onUpdate:modelValue":n[8]||(n[8]=t=>w.value=t),width:"60%",onClosed:X},{default:l(()=>[e(se,{ref_key:"userDialogFormRef",ref:g,model:a.value,rules:Y,"validate-on-rule-change":!1,"label-width":"100",style:{"margin-top":"20px"}},{default:l(()=>[V.value?(c(),v(h,{key:0,label:o(s)("users.username"),prop:"username"},{default:l(()=>[e(S,{modelValue:a.value.username,"onUpdate:modelValue":n[0]||(n[0]=t=>a.value.username=t)},null,8,["modelValue"])]),_:1},8,["label"])):b("",!0),e(h,{label:o(s)("users.nickname"),prop:"nickname"},{default:l(()=>[e(S,{modelValue:a.value.nickname,"onUpdate:modelValue":n[1]||(n[1]=t=>a.value.nickname=t)},null,8,["modelValue"])]),_:1},8,["label"]),V.value?(c(),v(h,{key:1,label:o(s)("users.password"),prop:"password"},{default:l(()=>[e(S,{modelValue:a.value.password,"onUpdate:modelValue":n[2]||(n[2]=t=>a.value.password=t),autocomplete:"new-password","show-password":""},null,8,["modelValue"]),e(fe,{modelValue:a.value.password,"onUpdate:modelValue":n[3]||(n[3]=t=>a.value.password=t)},null,8,["modelValue"]),_("div",ke,i(o(s)("users.suggestedPassword")),1)]),_:1},8,["label"])):b("",!0),e(h,{label:o(s)("users.clusterPermission"),prop:"clusterPermission"},{default:l(()=>[e(te,{modelValue:a.value.clusterPermission,"onUpdate:modelValue":n[4]||(n[4]=t=>a.value.clusterPermission=t),multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,disabled:a.value.role==="admin"},{default:l(()=>[(c(!0),I(me,null,ce(o(q).dstClusters,t=>(c(),v(ae,{label:t.clusterDisplayName,value:t.clusterName},null,8,["label","value"]))),256))]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"]),e(T,null,{default:l(()=>[e(U,{span:8},{default:l(()=>[e(h,{label:o(s)("users.disabled"),prop:"disabled"},{default:l(()=>[e(B,{modelValue:a.value.disabled,"onUpdate:modelValue":n[5]||(n[5]=t=>a.value.disabled=t),"active-text":d.value==="zh"?"启用":"Enable","active-value":!1,"inactive-text":d.value==="zh"?"禁用":"Disable","inactive-value":!0,"inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","active-text","inactive-text"])]),_:1},8,["label"])]),_:1}),e(U,{span:8},{default:l(()=>[e(h,{label:o(s)("users.admin"),prop:"role"},{default:l(()=>[e(B,{modelValue:a.value.role,"onUpdate:modelValue":n[6]||(n[6]=t=>a.value.role=t),"active-text":d.value==="zh"?"是":"Enable","inactive-text":d.value==="zh"?"否":"Disable","active-value":"admin","inactive-value":"Non-admin","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","active-text","inactive-text"])]),_:1},8,["label"])]),_:1}),e(U,{span:8},{default:l(()=>[e(h,{label:o(s)("users.clusterCreationProhibited"),prop:"role"},{default:l(()=>[e(B,{modelValue:a.value.clusterCreationProhibited,"onUpdate:modelValue":n[7]||(n[7]=t=>a.value.clusterCreationProhibited=t),"active-text":d.value==="zh"?"可创建":"Y","active-value":!1,"inactive-text":d.value==="zh"?"不可创建":"Y","inactive-value":!0,"inline-prompt":"",disabled:a.value.role==="admin",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","active-text","inactive-text","disabled"])]),_:1},8,["label"])]),_:1})]),_:1}),_("div",xe,[V.value?(c(),v(m,{key:0,loading:y.value,type:"primary",onClick:$},{default:l(()=>[p(i(o(s)("users.submit")),1)]),_:1},8,["loading"])):b("",!0),V.value?b("",!0):(c(),v(m,{key:1,loading:y.value,type:"primary",onClick:H},{default:l(()=>[p(i(o(s)("users.submit")),1)]),_:1},8,["loading"]))])]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{ze as default};
