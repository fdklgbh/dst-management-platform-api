import{t as b}from"./index-KnklNC4B.js";import{_ as J,u as Q,a as W,g as X,c as I,o as ee,r as h,A as d,d as te,e as ae,f as t,w as n,p as N,j as s,i as o,t as i,m as g,V as le,z as P,x as y,v as D,y as E}from"./index-Er8_s2TA.js";import{s as oe}from"./tools-Cv-d-7it.js";const ne={class:"page-div"},se={class:"card-header"},ie={style:{"margin-top":"20px"}},ce={style:{"line-height":"50px"}},ue={style:{"line-height":"50px"}},re={style:{"line-height":"50px"}},pe={style:{"line-height":"50px"}},de={class:"card-header"},me=le({name:"toolsBackup"}),fe=Object.assign(me,{setup(he){const{t:a}=Q(),{isMobile:w}=W(),S=X(),q=I(()=>S.isDark),u=I(()=>S.language);ee(()=>{k()});const B=h(!1),C=h(!1),M=h([]),f=h({enable:!1,time:"00:00:00"}),F=h(0),k=()=>{b.backup.get().then(e=>{M.value=e.data.backupFiles,f.value=e.data.backupSetting,F.value=e.data.diskUsage})},V=()=>{if(!f.value.time){P(a("tools.backup.timeChangeTip"));return}B.value=!0,C.value=!0;const e={time:f.value.time,enable:f.value.enable};b.backup.put(e).then(l=>{y(l.message)}).finally(()=>{B.value=!1,C.value=!1})},j=e=>{D.confirm(u.value==="zh"?"将执行删除操作，是否继续？":"The DELETE operation will be performed. Do you want to continue?",u.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:u.value==="zh"?"确定":"confirm",cancelButtonText:u.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(l,r,c)=>{if(l==="confirm"){r.confirmButtonLoading=!0;const m={name:e.name};b.backup.delete(m).then(_=>{y(_.message),c()}).catch(()=>{}).finally(()=>{r.confirmButtonLoading=!1,k()})}else c()}}).then(()=>{}).catch(()=>{E(a("home.canceled"))})},A=e=>{D.confirm(u.value==="zh"?"将执行恢复操作，是否继续？":"The RESTORE operation will be performed. Do you want to continue?",u.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:u.value==="zh"?"确定":"confirm",cancelButtonText:u.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(l,r,c)=>{if(l==="confirm"){r.confirmButtonLoading=!0;const m={name:e.name};b.backupRestore.post(m).then(_=>{y(_.message),c()}).catch(()=>{}).finally(()=>{r.confirmButtonLoading=!1,k()})}else c()}}).then(()=>{}).catch(()=>{E(a("home.canceled"))})},H=()=>{if(T.value.length===0){P(a("tools.backup.deleteTip"));return}D.confirm(u.value==="zh"?"将执行删除操作，是否继续？":"The DELETE operation will be performed. Do you want to continue?",u.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:u.value==="zh"?"确定":"confirm",cancelButtonText:u.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(e,l,r)=>{if(e==="confirm"){l.confirmButtonLoading=!0;const c={names:[]};for(let m of T.value)c.names.push(m.name);b.multiDelete.delete(c).then(m=>{y(m.message),r()}).catch(()=>{}).finally(()=>{l.confirmButtonLoading=!1,k()})}else r()}}).then(()=>{}).catch(()=>{E(a("home.canceled"))})},O=h(),T=h([]),G=e=>{T.value=e},K=e=>{if(e===0)return"0 B";const l=1024,r=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],c=Math.floor(Math.log(e)/Math.log(l));return parseFloat((e/Math.pow(l,c)).toFixed(2))+" "+r[c]},z=h(!1),Y=e=>{z.value=!0,b.backupDownload.post({filename:e.name}).then(async l=>{await oe(l.data,e.name)}).finally(()=>{z.value=!1})};return(e,l)=>{const r=d("el-progress"),c=d("el-time-picker"),m=d("el-switch"),_=d("el-alert"),$=d("el-card"),L=d("el-col"),x=d("el-button"),v=d("el-table-column"),Z=d("el-table"),R=d("el-row");return te(),ae("div",ne,[t(R,{gutter:10},{default:n(()=>[t(L,{lg:12,md:12,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:n(()=>[t($,{style:N(s(w)?"min-height: 500px":"min-height: 700px"),shadow:"never"},{header:n(()=>[o("div",se,i(s(a)("tools.backup.title1")),1)]),default:n(()=>[o("div",null,[t(r,{percentage:parseFloat(F.value.toFixed(1))},{default:n(({percentage:p})=>[o("span",null,i(s(a)("tools.backup.processBar"))+i(p)+"%",1)]),_:1},8,["percentage"])]),o("div",ie,[o("div",ce,[o("span",null,i(s(a)("tools.backup.text1")),1),t(c,{modelValue:f.value.time,"onUpdate:modelValue":l[0]||(l[0]=p=>f.value.time=p),loading:B.value,style:{width:"120px",margin:"0 8px"},clearable:!1,editable:!1,"value-format":"HH:mm:ss",onChange:V},null,8,["modelValue","loading"]),o("span",null,i(s(a)("tools.backup.text2")),1)]),o("div",ue,[o("span",null,i(s(a)("tools.backup.text3")),1),t(m,{modelValue:f.value.enable,"onUpdate:modelValue":l[1]||(l[1]=p=>f.value.enable=p),loading:C.value,"active-text":e.$t("tools.backup.switchEnable"),"inactive-text":e.$t("tools.backup.switchDisable"),"inline-prompt":"",onChange:V,style:{margin:"0 8px","--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","loading","active-text","inactive-text"])]),o("div",re,[o("span",null,i(s(a)("tools.backup.text4")),1)]),o("div",pe,[o("span",null,i(s(a)("tools.backup.text5")),1)])]),t(_,{effect:q.value?"light":"dark",type:"warning",closable:!1,style:{"margin-top":"20px"}},{default:n(()=>[g(i(s(a)("tools.backup.alert")),1)]),_:1},8,["effect"])]),_:1},8,["style"])]),_:1}),t(L,{lg:12,md:12,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:n(()=>[t($,{style:N(s(w)?"min-height: 500px":"min-height: 700px"),shadow:"never"},{header:n(()=>[o("div",de,[g(i(s(a)("tools.backup.title2"))+" ",1),t(x,{type:"danger",onClick:H},{default:n(()=>[g(i(s(a)("tools.backup.multiDelete")),1)]),_:1})])]),default:n(()=>[o("div",null,[t(R,null,{default:n(()=>[t(Z,{ref_key:"tableRef",ref:O,data:M.value,border:"",onSelectionChange:G,"max-height":s(w)?"min-height: 450px":"min-height: 650px"},{default:n(()=>[t(v,{type:"selection",width:"55",fixed:"left"}),t(v,{label:e.$t("tools.backup.tableName"),prop:"name"},null,8,["label"]),t(v,{label:e.$t("tools.backup.size"),prop:"size"},{default:n(p=>[g(i(K(p.row.size)),1)]),_:1},8,["label"]),t(v,{label:e.$t("tools.backup.tableCreateTime"),prop:"createTime"},null,8,["label"]),t(v,{prop:"actions",label:e.$t("setting.button.actions"),width:"100px"},{default:n(p=>[o("div",null,[t(x,{link:"",type:"primary",onClick:U=>Y(p.row),loading:z.value},{default:n(()=>[g(i(s(a)("tools.backup.download")),1)]),_:2},1032,["onClick","loading"])]),o("div",null,[t(x,{link:"",type:"warning",onClick:U=>A(p.row)},{default:n(()=>[g(i(s(a)("tools.backup.restore")),1)]),_:2},1032,["onClick"])]),o("div",null,[t(x,{link:"",type:"danger",onClick:U=>j(p.row)},{default:n(()=>[g(i(s(a)("tools.backup.delete")),1)]),_:2},1032,["onClick"])])]),_:1},8,["label"])]),_:1},8,["data","max-height"])]),_:1})])]),_:1},8,["style"])]),_:1})]),_:1})])}}}),ve=J(fe,[["__scopeId","data-v-a9aaa467"]]);export{ve as default};
