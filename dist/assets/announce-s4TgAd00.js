import{u as X,a as Y,g as Z,D as ee,G as ne,b as oe,H as le,c as M,o as te,r as _,w as ae,I as q,J as u,e as g,f as se,j as o,k as l,x as ue,i as r,l as V,p as d,t as i,m as A,a0 as re,C as ce,A as N,E as ie,B as de}from"./index-C-KsYsfv.js";import{t as C}from"./index-BAjU4gOB.js";const me={class:"page-div"},pe={class:"card-header"},fe={class:"el-form-item-msg"},be={class:"dialog-footer"},_e=re({name:"toolsAnnounce"}),ke=Object.assign(_e,{setup(ge){const{t}=X(),{isMobile:v}=Y(),m=Z(),y=ee();ne();const S=oe(),B=le("refresh");M(()=>m.isDark),M(()=>m.language),te(()=>{k()});const $=_([]),k=()=>{const n={clusterName:m.selectedDstCluster};C.announce.get(n).then(e=>{$.value=e.data})},h=_(""),T=()=>{s.value={name:"",enable:!0,content:"",frequency:600},q(()=>{f.value.clearValidate()}),h.value="post",p.value=!0},p=_(!1),f=_(),s=_({name:"",enable:!0,content:"",frequency:600}),E={name:[{required:!0,message:t("tools.announce.rules.name"),trigger:"blur"}],enable:[{required:!0,message:t("tools.announce.rules.enable"),trigger:"change"}],content:[{required:!0,message:t("tools.announce.rules.content"),trigger:"blur"}],frequency:[{required:!0,message:t("tools.announce.rules.frequency"),trigger:"blur"}]},R=()=>{if(s.value.frequency<1){ce(t("tools.announce.rules.frequencyMin"));return}switch(h.value){case"post":U();break;case"put":j();break}},U=()=>{f.value.validate(n=>{if(n){const e={clusterName:m.selectedDstCluster,autoAnnounce:s.value};C.announce.post(e).then(c=>{p.value=!1,N(c.message),k()})}})},z=n=>{ie.confirm(t("tools.announce.deleteTip"),"Warning",{confirmButtonText:t("tools.announce.confirm"),cancelButtonText:t("tools.announce.cancel"),type:"warning"}).then(()=>{const e={clusterName:m.selectedDstCluster,autoAnnounce:n};C.announce.delete(e).then(c=>{N(c.message),k()})}).catch(()=>{de(t("home.canceled"))})},K=n=>{s.value=n,q(()=>{f.value.clearValidate()}),h.value="put",p.value=!0},j=()=>{f.value.validate(n=>{if(n){const e={clusterName:m.selectedDstCluster,autoAnnounce:s.value};C.announce.put(e).then(c=>{p.value=!1,N(c.message),k()})}})},x=()=>{setTimeout(()=>{y.meta.isKeepAlive&&S.removeKeepAliveName(y.name),B(!1),q(()=>{y.meta.isKeepAlive&&S.addKeepAliveName(y.name),B(!0)})},0)};return ae(()=>m.selectedDstCluster,n=>{n&&q(()=>{x()})},{immediate:!1}),(n,e)=>{const c=u("el-button"),b=u("el-table-column"),F=u("el-tag"),I=u("el-table"),P=u("el-result"),G=u("el-card"),H=u("el-col"),J=u("el-row"),D=u("el-input"),w=u("el-form-item"),O=u("el-switch"),W=u("el-form"),L=u("el-dialog");return g(),se("div",me,[o(J,{gutter:10},{default:l(()=>[o(H,{lg:24,md:24,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:l(()=>[o(G,{style:ue(r(v)?"min-height: 500px":"min-height: 700px"),shadow:"never"},{header:l(()=>[V("div",pe,[d(i(r(t)("tools.announce.title"))+" ",1),V("div",null,[o(c,{size:"default",type:"success",onClick:T},{default:l(()=>[d(i(r(t)("tools.announce.new")),1)]),_:1})])])]),default:l(()=>[$.value.length>0?(g(),A(I,{key:0,data:$.value,border:"",size:"small",style:{width:"100%"},"tooltip-effect":"light"},{default:l(()=>[o(b,{label:n.$t("tools.announce.name"),prop:"name"},null,8,["label"]),o(b,{label:n.$t("tools.announce.isEnable"),prop:"enable"},{default:l(a=>[a.row.enable?(g(),A(F,{key:0,type:"success"},{default:l(()=>[d(i(r(t)("tools.announce.enable")),1)]),_:1})):(g(),A(F,{key:1,type:"danger"},{default:l(()=>[d(i(r(t)("tools.announce.disable")),1)]),_:1}))]),_:1},8,["label"]),o(b,{label:n.$t("tools.announce.frequency"),prop:"frequency"},{default:l(a=>e[6]||(e[6]=[])),_:1},8,["label"]),o(b,{label:n.$t("tools.announce.content"),prop:"content","show-overflow-tooltip":""},{default:l(a=>e[7]||(e[7]=[])),_:1},8,["label"]),o(b,{label:n.$t("tools.announce.actions"),fixed:"right",prop:"actions",width:"140"},{default:l(a=>[o(c,{link:"",type:"primary",onClick:Q=>K(a.row)},{default:l(()=>[d(i(r(t)("tools.announce.update")),1)]),_:2},1032,["onClick"]),o(c,{link:"",type:"danger",onClick:Q=>z(a.row)},{default:l(()=>[d(i(r(t)("tools.announce.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])):(g(),A(P,{key:1,title:n.$t("tools.announce.noData"),icon:"warning",style:{"margin-top":"10%"}},null,8,["title"]))]),_:1},8,["style"])]),_:1})]),_:1}),o(L,{modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=a=>p.value=a),"close-on-click-modal":!1,title:n.$t("tools.announce.new"),width:"60%"},{footer:l(()=>[V("div",be,[o(c,{onClick:e[4]||(e[4]=a=>p.value=!1)},{default:l(()=>[d(i(r(t)("tools.announce.cancel")),1)]),_:1}),o(c,{type:"primary",onClick:R},{default:l(()=>[d(i(r(t)("tools.announce.submit")),1)]),_:1})])]),default:l(()=>[o(W,{ref_key:"announceFormRef",ref:f,"label-position":r(v)?"top":"left","label-width":r(v)?"70":"auto",model:s.value,rules:E,size:r(v)?"small":"large"},{default:l(()=>[o(w,{label:n.$t("tools.announce.name"),prop:"name"},{default:l(()=>[o(D,{modelValue:s.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.name=a),disabled:h.value==="put"},null,8,["modelValue","disabled"])]),_:1},8,["label"]),o(w,{label:n.$t("tools.announce.isEnable"),prop:"enable"},{default:l(()=>[o(O,{modelValue:s.value.enable,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.enable=a)},null,8,["modelValue"])]),_:1},8,["label"]),o(w,{label:n.$t("tools.announce.content"),prop:"content"},{default:l(()=>[o(D,{modelValue:s.value.content,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.content=a)},null,8,["modelValue"])]),_:1},8,["label"]),o(w,{label:n.$t("tools.announce.frequency"),prop:"frequency"},{default:l(()=>[o(D,{modelValue:s.value.frequency,"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.frequency=a),modelModifiers:{number:!0},min:1,step:1},null,8,["modelValue"]),V("div",fe,i(r(t)("tools.announce.frequencyTip")),1)]),_:1},8,["label"])]),_:1},8,["label-position","label-width","model","size"])]),_:1},8,["modelValue","title"])])}}});export{ke as default};
